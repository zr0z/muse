<!DOCTYPE html>  <html> <head>   <title>muse.m</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               muse.m             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>muse 0.2,
the stupid command line mp3 player for osx.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p><em>muse may be freely distributed under the MIT license.</em></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Frameworks: <em>Foundation</em>, <em>AVFoundation</em></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>
<span class="cp">#import &lt;AVFoundation/AVFoundation.h&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Uses arc memory management.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Helpers declaration</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Define the usage description printed when executing the command
with a help option (<code>[-h|--help]</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cp">#define USAGE @&quot;usage: muse [-h|--help] &lt;music file&gt;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><code>output</code> is an helper function to display <code>NSString</code> on <code>stdout</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kt">void</span> <span class="n">ouptut</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span> <span class="n">string</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>Custom Errors</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Define custom error domain and descriptions as <code>NSString</code> constants.</p>

<p>The error domain is <code>muse</code>; the customs errors are:</p>

<ul>
<li><code>MPErrorInputFile</code> when no file is given in arguments.</li>
<li><code>MPErrorFileType</code> when the file can't be read.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">MPErrorDomain</span> <span class="o">=</span> <span class="s">@&quot;muse&quot;</span><span class="p">;</span>
<span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">MPErrorInputFile</span> <span class="o">=</span> <span class="s">@&quot;no input files.&quot;</span><span class="p">;</span>
<span class="n">NSString</span> <span class="o">*</span><span class="k">const</span> <span class="n">MPErrorFileType</span> <span class="o">=</span> <span class="s">@&quot;muse.man&#39;t handle this file.&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>Category interface.</h3>

<p>Create a category on NSError for muse with two default class methods
that correspond to the customs errors.</p>

<p>The category add also an instance method which construct a description
based on the error domain and the error <code>NSLocalizedDescriptionKey</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">@interface</span> <span class="n">NSError</span><span class="p">(</span><span class="n">MusePlayer</span><span class="p">)</span>
<span class="o">+</span> <span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">museErrorInputFile</span><span class="p">;</span>
<span class="o">+</span> <span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">museErrorFileType</span><span class="p">;</span>
<span class="o">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">description</span><span class="p">;</span>
<span class="k">@end</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3>Category implementation.</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">@implementation</span> <span class="n">NSError</span><span class="p">(</span><span class="n">MusePlayer</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Return a <code>NSError</code> using a <code>MPErrorInputFile</code> localized description.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">+</span> <span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">museErrorInputFile</span> <span class="p">{</span>
  <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="p">@{</span><span class="n">NSLocalizedDescriptionKey</span><span class="o">:</span> <span class="n">MPErrorInputFile</span><span class="p">};</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="n">errorWithDomain</span><span class="o">:</span><span class="n">MPErrorDomain</span> <span class="n">code</span><span class="o">:</span><span class="mi">1</span> <span class="n">userInfo</span><span class="o">:</span><span class="n">info</span><span class="p">];</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Return a <code>NSError</code> using a <code>MPErrorFileType</code> localized description.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">+</span> <span class="p">(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="n">museErrorFileType</span> <span class="p">{</span>
  <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="p">@{</span><span class="n">NSLocalizedDescriptionKey</span><span class="o">:</span> <span class="n">MPErrorFileType</span><span class="p">};</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="n">errorWithDomain</span><span class="o">:</span><span class="n">MPErrorDomain</span> <span class="n">code</span><span class="o">:</span><span class="mi">2</span> <span class="n">userInfo</span><span class="o">:</span><span class="n">info</span><span class="p">];</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Instance method which construct a description based on the domain
and the <code>NSLocalizedDescriptionKey</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">description</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="n">stringWithFormat</span><span class="o">:</span><span class="s">@&quot;%@: error: %@&quot;</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">domain</span><span class="p">,</span>
      <span class="n">self</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>MuseAsset Class</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3>Class interface.</h3>

<p>The <code>MuseAsset</code> Class use an instance of the <code>AVURLAsset</code> class
to store some metadatas as properties of the instance.</p>

<p>The main property is the <code>URL</code> used to create the <code>AVURLAsset</code>.</p>

<p>The metadatas properties are:</p>

<ul>
<li><code>length</code>, duration of the asset in seconds,</li>
<li><code>artist</code>, name of the artist if present in the <code>commonMetadata</code>,</li>
<li><code>album</code>, name of the album if present in the <code>commonMetadata</code>,</li>
<li><code>label</code>, label constructed from the other properties,</li>
<li><code>title</code>, title of the asset if present in the <code>commonMetadata</code>.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">@interface</span> <span class="n">MuseAsset</span> <span class="o">:</span> <span class="n">NSObject</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">_length</span><span class="p">;</span>
  <span class="n">NSString</span><span class="o">*</span> <span class="n">_title</span><span class="p">;</span>
  <span class="n">NSString</span><span class="o">*</span> <span class="n">_artist</span><span class="p">;</span>
  <span class="n">NSString</span><span class="o">*</span> <span class="n">_album</span><span class="p">;</span>
  <span class="n">NSString</span><span class="o">*</span> <span class="n">_label</span><span class="p">;</span>
  <span class="n">NSURL</span><span class="o">*</span> <span class="n">_URL</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">int</span> <span class="n">length</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span><span class="o">*</span> <span class="n">artist</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span><span class="o">*</span> <span class="n">album</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span><span class="o">*</span> <span class="n">label</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span><span class="o">*</span> <span class="n">title</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSURL</span><span class="o">*</span> <span class="n">URL</span><span class="p">;</span>
<span class="o">+</span> <span class="p">(</span><span class="n">MuseAsset</span> <span class="o">*</span><span class="p">)</span><span class="n">museAssetWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="n">URL</span><span class="p">;</span>
<span class="o">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">initWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="n">URL</span><span class="p">;</span>
<span class="o">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">metadataForKey</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">key</span> <span class="n">inArray</span><span class="o">:</span><span class="p">(</span><span class="n">NSArray</span><span class="o">*</span><span class="p">)</span><span class="n">metadata</span><span class="p">;</span>
<span class="k">@end</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>Class implementation.</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">@implementation</span> <span class="n">MuseAsset</span>
<span class="k">@synthesize</span> <span class="n">length</span> <span class="o">=</span> <span class="n">_length</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">title</span> <span class="o">=</span> <span class="n">_title</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">artist</span> <span class="o">=</span> <span class="n">_artist</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">album</span> <span class="o">=</span> <span class="n">_album</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">label</span> <span class="o">=</span> <span class="n">_label</span><span class="p">;</span>
<span class="k">@synthesize</span> <span class="n">URL</span> <span class="o">=</span> <span class="n">_URL</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Class methods that create a new instance using an URL.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">+</span> <span class="p">(</span><span class="n">MuseAsset</span> <span class="o">*</span><span class="p">)</span><span class="n">museAssetWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="n">URL</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithURL</span><span class="o">:</span><span class="n">URL</span><span class="p">];</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>The <code>initWithURL</code> initialize each properties and the asset instance.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">initWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="n">URL</span> <span class="p">{</span>
  <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Create the <code>AVURLAsset</code> instance using the <code>URL</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="n">AVURLAsset</span><span class="o">*</span> <span class="n">asset</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVURLAsset</span> <span class="n">URLAssetWithURL</span><span class="o">:</span><span class="n">URL</span> <span class="n">options</span><span class="o">:</span><span class="n">nil</span><span class="p">];</span>
  <span class="k">if</span><span class="p">(</span><span class="n">self</span> <span class="o">&amp;&amp;</span> <span class="n">asset</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Assign <code>MuseAsset</code> url.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">self</span><span class="p">.</span><span class="n">URL</span> <span class="o">=</span> <span class="n">URL</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Calculate the track <code>length</code> in seconds using the <code>value</code>
and the <code>timescale</code> of the <code>duration</code> metadata.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">self</span><span class="p">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">asset</span><span class="p">.</span><span class="n">duration</span><span class="p">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">asset</span><span class="p">.</span><span class="n">duration</span><span class="p">.</span><span class="n">timescale</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>initialize the metadata array using the <code>commonMetadata</code> property
of the asset.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">NSArray</span><span class="o">*</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">asset</span><span class="p">.</span><span class="n">commonMetadata</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Extract the other properties from the metadata array
calling the <code>metadataForKey:inArray:</code> method.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">self</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">metadataForKey</span><span class="o">:</span><span class="s">@&quot;title&quot;</span> <span class="n">inArray</span><span class="o">:</span><span class="n">metadata</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">artist</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">metadataForKey</span><span class="o">:</span><span class="s">@&quot;artist&quot;</span> <span class="n">inArray</span><span class="o">:</span><span class="n">metadata</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">album</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">metadataForKey</span><span class="o">:</span><span class="s">@&quot;albumName&quot;</span> <span class="n">inArray</span><span class="o">:</span><span class="n">metadata</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Transform the track <code>length</code> (in seconds) in a duration in minutes
and seconds, using a formated string.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">NSString</span><span class="o">*</span> <span class="n">durationString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="n">stringWithFormat</span><span class="o">:</span><span class="s">@&quot;%02d:%02d&quot;</span><span class="p">,</span>
      <span class="n">self</span><span class="p">.</span><span class="n">length</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">length</span> <span class="o">%</span> <span class="mi">60</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Compose the label property using the other properties.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="n">self</span><span class="p">.</span><span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="n">stringWithFormat</span><span class="o">:</span><span class="s">@&quot;%@ - %@ (%@)</span><span class="se">\n</span><span class="s">%@</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
      <span class="n">self</span><span class="p">.</span><span class="n">title</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">artist</span><span class="p">,</span> <span class="n">durationString</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">album</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Parse a <code>NSArray</code> of <code>AVMetadataItem</code> using a <code>NSString</code>
as the common key.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">metadataForKey</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="n">key</span> <span class="n">inArray</span><span class="o">:</span><span class="p">(</span><span class="n">NSArray</span><span class="o">*</span><span class="p">)</span><span class="n">metadata</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Parse the metadata from the asset.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="n">NSArray</span><span class="o">*</span> <span class="n">collected</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVMetadataItem</span> <span class="n">metadataItemsFromArray</span><span class="o">:</span><span class="n">metadata</span>
    <span class="nl">withKey:</span><span class="n">key</span> <span class="n">keySpace</span><span class="o">:</span> <span class="n">AVMetadataKeySpaceCommon</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Return the corresponding <code>NSString</code> if found or the <code>@"Unknown"</code> string.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span><span class="p">([</span><span class="n">collected</span> <span class="n">count</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
      <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">AVMetadataItem</span><span class="o">*</span><span class="p">)</span> <span class="n">collected</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">).</span><span class="n">stringValue</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="s">@&quot;Unknown&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h2>MusePlayer class</h2>

<h3>Class interface.</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">@interface</span> <span class="n">MusePlayer</span> <span class="o">:</span> <span class="n">NSObject</span> <span class="p">{</span>
  <span class="n">AVAudioPlayer</span> <span class="o">*</span><span class="n">player</span><span class="p">;</span>
  <span class="n">MuseAsset</span> <span class="o">*</span><span class="n">currentSong</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">MuseAsset</span> <span class="o">*</span><span class="n">currentSong</span><span class="p">;</span>
<span class="o">+</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="n">playerWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span><span class="o">*</span><span class="p">)</span><span class="n">URL</span> <span class="n">error</span><span class="o">:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="n">error</span><span class="p">;</span>
<span class="o">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="n">initWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span><span class="o">*</span><span class="p">)</span><span class="n">URL</span> <span class="n">error</span><span class="o">:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="n">error</span><span class="p">;</span>
<span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">addAssetWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span><span class="o">*</span><span class="p">)</span><span class="n">URL</span> <span class="n">error</span><span class="o">:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="n">error</span><span class="p">;</span>
<span class="o">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">prepareToPlay</span><span class="p">;</span>
<span class="o">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">isPlaying</span><span class="p">;</span>
<span class="o">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">play</span><span class="p">;</span>
<span class="k">@end</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h3>Class implementation.</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">@implementation</span> <span class="n">MusePlayer</span>
<span class="k">@synthesize</span> <span class="n">currentSong</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Class methods that create a new instance using an <code>URL</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">+</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="n">playerWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span><span class="o">*</span><span class="p">)</span><span class="n">URL</span> <span class="n">error</span><span class="o">:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="n">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[[</span><span class="n">self</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithURL</span><span class="o">:</span><span class="n">URL</span> <span class="n">error</span><span class="o">:</span><span class="n">error</span><span class="p">];</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>The <code>initWithURL:error:</code> method tests if the <code>URL</code> is reachable
and add a new asset if no errors were raised.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="n">initWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span><span class="o">*</span><span class="p">)</span><span class="n">URL</span> <span class="n">error</span><span class="o">:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="n">error</span> <span class="p">{</span>
  <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="n">init</span><span class="p">];</span>
  <span class="k">if</span><span class="p">(</span><span class="n">self</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">URL</span> <span class="n">checkResourceIsReachableAndReturnError</span><span class="o">:</span><span class="n">error</span><span class="p">]){</span>
    <span class="p">[</span><span class="n">self</span> <span class="n">addAssetWithURL</span><span class="o">:</span><span class="n">URL</span> <span class="n">error</span><span class="o">:</span><span class="n">error</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Call the <code>prepareToPlay</code> method to set the player
and start the buffering of the asset.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span><span class="n">self</span> <span class="n">prepareToPlay</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Create an asset using its url and a pointer to a <code>NSError</code> instance.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">addAssetWithURL</span><span class="o">:</span><span class="p">(</span><span class="n">NSURL</span><span class="o">*</span><span class="p">)</span><span class="n">URL</span> <span class="n">error</span><span class="o">:</span><span class="p">(</span><span class="n">NSError</span> <span class="o">**</span><span class="p">)</span><span class="n">error</span> <span class="p">{</span>
  <span class="n">self</span><span class="p">.</span><span class="n">currentSong</span> <span class="o">=</span> <span class="p">[</span><span class="n">MuseAsset</span> <span class="n">museAssetWithURL</span><span class="o">:</span><span class="n">URL</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Return an error if the file has no length.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">currentSong</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
    <span class="o">*</span><span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSError</span> <span class="n">museErrorFileType</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Create an audio player and prepare it to read the asset.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">prepareToPlay</span> <span class="p">{</span>
  <span class="n">player</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AVAudioPlayer</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithContentsOfURL</span><span class="o">:</span><span class="n">self</span><span class="p">.</span><span class="n">currentSong</span><span class="p">.</span><span class="n">URL</span> <span class="n">error</span><span class="o">:</span><span class="n">nil</span><span class="p">];</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">player</span> <span class="n">prepareToPlay</span><span class="p">];</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Wrapper around the <code>isPlaying</code> method of the player.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">isPlaying</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">player</span> <span class="n">isPlaying</span><span class="p">];</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Wrapper around the <code>play</code> method of the player.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">play</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">player</span> <span class="n">play</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <h2>Main function</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="kt">int</span> <span class="n">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="k">@autoreleasepool</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Get the arguments from the command line. <strong>muse</strong> accepts
either a help option (<code>[-h|--help]</code>) or a file.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="n">NSArray</span><span class="o">*</span> <span class="n">arguments</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSProcessInfo</span> <span class="n">processInfo</span><span class="p">]</span> <span class="n">arguments</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Test if the help option (<code>[-h|--help]</code>) is present
in the arguments list.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span><span class="p">([</span><span class="n">arguments</span> <span class="n">containsObject</span><span class="o">:</span><span class="s">@&quot;-h&quot;</span><span class="p">]</span>
          <span class="o">||</span> <span class="p">[</span><span class="n">arguments</span> <span class="n">containsObject</span><span class="o">:</span><span class="s">@&quot;--help&quot;</span><span class="p">]){</span>
            <span class="n">ouptut</span><span class="p">(</span><span class="n">USAGE</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="p">[</span><span class="n">arguments</span> <span class="n">count</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Return an error if no arguments were given.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="n">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
            <span class="n">ouptut</span><span class="p">([</span><span class="n">NSError</span> <span class="n">museErrorInputFile</span><span class="p">].</span><span class="n">description</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Get the url of the media file.</p>

<blockquote>
  <p>TODO: add multiple file and directory handling.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="n">NSURL</span><span class="o">*</span> <span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="n">fileURLWithPath</span><span class="o">:</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
        <span class="n">NSError</span><span class="o">*</span> <span class="n">error</span> <span class="o">=</span> <span class="n">nil</span><span class="p">;</span>
        <span class="n">MusePlayer</span><span class="o">*</span> <span class="n">muse</span> <span class="o">=</span> <span class="p">[</span><span class="n">MusePlayer</span> <span class="n">playerWithURL</span><span class="o">:</span><span class="n">url</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Return an error if the file is not a media file.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="n">error</span> <span class="o">!=</span> <span class="n">nil</span><span class="p">){</span>
          <span class="n">ouptut</span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">description</span><span class="p">);</span>
          <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Print the informations to the command line.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="n">ouptut</span><span class="p">(</span><span class="n">muse</span><span class="p">.</span><span class="n">currentSong</span><span class="p">.</span><span class="n">label</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Read the file and quit once its done.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">[</span><span class="n">muse</span> <span class="n">play</span><span class="p">];</span>
        <span class="k">while</span><span class="p">([</span><span class="n">muse</span> <span class="n">isPlaying</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <h2>Helpers functions</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p><code>ouput</code> send the <code>UTF8String</code> message to the the <code>NSString</code>
to print a string to the <code>stdout</code> using the <code>puts</code> function.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kt">void</span> <span class="n">ouptut</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span> <span class="n">string</span><span class="p">){</span>
  <span class="n">puts</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">UTF8String</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Copyright (c) 2012 Zaidin Amiot.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 
